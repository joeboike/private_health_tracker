<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Daily Log</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Joe's Health Tracker</h1>
    <h2>7-Day Averages</h2>
    <h3>Body Metrics</h3>
    <table class="macro-table">
    <tbody>
        <tr>
        <td>Weight</td>
        <td>{{ avg_weight }} lbs</td>
        <td>{{ weight_arrow }}</td>
        </tr>
        <tr>
        <td>Muscle Mass</td>
        <td>{{ avg_musclemass }} lbs</td>
        <td>{{ musclemass_arrow }}</td>
        </tr>
        <tr>
        <td>Body Fat </td>
        <td>{{ avg_body_fat }}%</td>
        <td>{{ body_fat_arrow }} {{ body_fat_flag }}</td>
        </tr>
        <tr>
        <td>Visceral Fat</td>
        <td>{{ avg_visceral_fat }}</td>
        <td>{{ visceral_fat_arrow }} {{ visceral_fat_flag }}</td>
        </tr>
    </tbody>
    </table>

    <h3>Nutrition Stats</h3>
    <table class="macro-table">
    <thead>
        <tr>
        <th>Macro</th>
        <th>Quantity</th>
        <th>Calories Pct</th>
        <th>Target</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        <td>Calories</td>
        <td>{{ avg_calories }}</td>
        <td>{{ 100 }}%</td>
        <td>—</td>
        </tr>
        <tr>
        <td>Protein</td>
        <td>{{ avg_protein }}g</td>
        <td>{{ pct_protein }}%</td>
        <td>
            {% if avg_protein >= 120 %}
            ✅
            {% else %}
            ❌
            {% endif %}
        </td>
        </tr>
        <tr>
        <td>Carbs</td>
        <td>{{ avg_carbs }}g</td>
        <td>{{ pct_carbs }}%</td>
        <td>—</td>
        </tr>
        <tr>
        <td>Fat</td>
        <td>{{ avg_fat }}g</td>
        <td>{{ pct_fat }}%</td>
        <td>
            {% if pct_fat < 30 %}
            ✅
            {% else %}
            ❌
            {% endif %}
        </td>
        </tr>
        <tr>
        <td>Fiber</td>
        <td>{{ avg_fiber }}g</td>
        <td>—</td>
        <td>
            {% if avg_fiber >= 35 %}
            ✅
            {% else %}
            ❌
            {% endif %}
        </td>
        </tr>
    </tbody>
    </table>
    <!--<p>Use the links below to log your day:</p>-->
        <h3>Metrics</h3>
    <form class="button-container" method="GET">
        <button type="submit" formaction="/log/metrics">Log</button>
        <button type="submit" formaction="/charts">Chart</button>
    </form>

        <h3>Log Nutrition</h3>
    <form class="button-container" method="GET">
        <button type="submit" formaction="/log/daily_menu">Daily</button>
        <button type="submit" formaction="/log/recipe">Recipe</button>
        <button type="submit" formaction="/log/ingredient">Ingredient</button>
    </form>

    <h3>Daily Menus</h3>
        <div class="menu-action-row">
        <!-- Shared dropdown -->
        <select id="menuSelect">
            {% for menu in menus %}
            <option value="{{ menu[0] }}">{{ menu[2].isoformat() }}: {{ menu[1] }}</option>
            {% endfor %}
        </select>
        </div>
        <!--<br>-->
        <div class="menu-action-row">
        <!-- View/Edit form (GET) -->
        <form id="menuForm" method="GET" style="display: inline;">
            <button type="submit" formaction="/view/menu/{{ menus[0].id }}" class="view-button">View</button>
        </form>
        <form id="menuForm" method="GET" style="display: inline;">
            <button type="submit" formaction="/edit/menu/{{ menus[0].id }}" class="edit-button">Edit</button>
        </form>

        <!-- Delete form (POST) -->
        <form id="deleteForm" method="POST" action="/delete/menu/{{ menus[0].id }}" onsubmit="return confirm('Delete this menu?');" style="display: inline;">
            <button type="submit" class="delete-button">Delete</button>
        </form>
        </div>

        <script>
        const select = document.getElementById('menuSelect');
        const viewBtn = document.querySelector('.view-button');
        const editBtn = document.querySelector('.edit-button');
        const deleteForm = document.getElementById('deleteForm');

        function updateActions() {
            const selectedId = select.value;
            viewBtn.formAction = `/view/menu/${selectedId}`;
            editBtn.formAction = `/edit/menu/${selectedId}`;
            deleteForm.action = `/delete/menu/${selectedId}`;
        }

        select.addEventListener('change', updateActions);
        updateActions(); // initialize on page load
        </script>

</body>
</html>